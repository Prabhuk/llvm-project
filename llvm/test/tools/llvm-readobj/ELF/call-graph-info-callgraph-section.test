## Tests --call-graph-info prints information from call graph section.

# RUN: llvm-mc %s -filetype=obj -triple=x86_64-pc-linux -o %t
# RUN: llvm-readelf --call-graph-info %t 2>&1 | FileCheck %s -DFILE=%t

# CHECK: INDIRECT TARGET TYPES (TYPEID [FUNC_ADDR,])
# CHECK-NEXT: UNKNOWN 6
# CHECK-NEXT: 20 a
# CHECK-EMPTY:
# CHECK-NEXT: INDIRECT CALL TYPES (TYPEID [CALL_SITE_ADDR,])
# CHECK-NEXT: 10 9
# CHECK-EMPTY:
# CHECK-NEXT: INDIRECT CALL SITES (CALLER_ADDR [CALL_SITE_ADDR,])
# CHECK-NEXT: 6 9
# CHECK-EMPTY:
# CHECK-NEXT: DIRECT CALL SITES (CALLER_ADDR [(CALL_SITE_ADDR, TARGET_ADDR),])
# CHECK-NEXT: 0 5 5
#
#FUNCTIONS (FUNC_ENTRY_ADDR, SYM_NAME)
# 0 foo
# 6 bar
# a baz
# b qux

.text

.globl foo
.type foo,@function
foo:                  #< foo is at 0.
.Lfoo_begin:
 callq foo            #< direct call is at 5. target is foo (5).
 retq

.globl bar
.type bar,@function
bar:                  #< bar is at 6.
 callq	*-40(%rbp)    #< indirect call is at 9.
 retq

.globl baz
.type baz,@function
baz:                  #< baz is at 10 (a).
 retq

.globl qux
.type qux,@function
qux:                  #< qux is at 11 (b).
 retq

.section	.callgraph,"o",@progbits,.text
.quad	0       #< Format version number.
.quad	0       #< foo()'s entry address.
.quad	0       #< Function kind: not an indirect target.
.quad	0       #< Count of indirect call sites that follow: 0.
.quad   1       #< Count of direct call sites that follow: 1>
.quad   5       #< Direct callsite call to foo>
.quad   5       #< Direct callee foo's address>

.quad	0       #< Format version number.
.quad	6       #< bar()'s entry address.
.quad	1       #< Function kind: indirect target with unknown type id.
.quad	1       #< Count of indirect call sites that follow: 1.
.quad 16      #< Indirect call type id.
.quad 9       #< Indirect call site.
.quad   0       #< Count of direct call sites that follow: 0>

.quad	0       #< Format version number.
.quad	10      #< baz()'s entry address.
.quad	2       #< Function kind: indirect target with known type id.
.quad 32      #< Indirect target type id.
.quad	0       #< Count of indirect call sites that follow: 0>.
.quad   0       #< Count of direct call sites that follow: 0>

# No call graph section entry for qux. 
# Technically its "UNKNOWN" type id but will not be printed as such by llvm-readelf.  

.text
